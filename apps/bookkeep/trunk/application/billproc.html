<html>
<head>
<title>billproc.php</title>
<style type="text/css"><!--
.syntax0 {
color: #666666;
}
.syntax1 {
color: #cc0000;
}
.syntax2 {
color: #ff9900;
}
.syntax3 {
color: #6600cc;
}
.syntax4 {
color: #cc6600;
}
.syntax5 {
color: #ff0000;
}
.syntax6 {
color: #009933;
}
.syntax7 {
background: #ffffcc;
color: #ff0066;
}
.syntax8 {
color: #006699;
font-weight: bold;
}
.syntax9 {
color: #009966;
font-weight: bold;
}
.syntax10 {
color: #0099ff;
font-weight: bold;
}
.syntax11 {
color: #66ccff;
font-weight: bold;
}
.syntax12 {
color: #02b902;
}
.syntax13 {
color: #ff00cc;
}
.syntax14 {
color: #cc00cc;
}
.syntax15 {
color: #9900cc;
}
.syntax16 {
color: #6600cc;
}
.syntax17 {
color: #0000ff;
}
.syntax18 {
color: #000000;
font-weight: bold;
}
--></style>
</head>
<body bgcolor="#f0f0f0">
<pre><span class="syntax0"><span class="syntax17">&lt;?php</span>
<span class="syntax8">class</span><span class="syntax8"> </span><span class="syntax11">billproc</span><span class="syntax11"> </span><span class="syntax8">extends</span><span class="syntax11"> </span><span class="syntax11">x_table2</span><span class="syntax11"> </span><span class="syntax18">{</span>
    <span class="syntax8">function</span> <span class="syntax9">main</span><span class="syntax18">(</span><span class="syntax18">)</span> <span class="syntax18">{</span>
        <span class="syntax4">#</span><span class="syntax4"> </span><span class="syntax4">Call</span><span class="syntax4"> </span><span class="syntax4">out</span><span class="syntax4"> </span><span class="syntax4">to</span><span class="syntax4"> </span><span class="syntax4">get</span><span class="syntax4"> </span><span class="syntax4">some</span><span class="syntax4"> </span><span class="syntax4">vital</span><span class="syntax4"> </span><span class="syntax4">stats</span>
        <span class="syntax8">list</span><span class="syntax18">(</span><span class="syntax10">$cnt_ol</span><span class="syntax18">,</span><span class="syntax10">$cnt_os</span><span class="syntax18">,</span><span class="syntax10">$customers</span><span class="syntax18">)</span> <span class="syntax18">=</span> <span class="syntax11">$this</span><span class="syntax6">-&gt;makeInquiries</span><span class="syntax18">(</span><span class="syntax18">)</span><span class="syntax18">;</span>
        
        <span class="syntax4">#</span><span class="syntax4"> </span><span class="syntax4">If</span><span class="syntax4"> </span><span class="syntax4">they</span><span class="syntax4"> </span><span class="syntax4">asked</span><span class="syntax4"> </span><span class="syntax4">us</span><span class="syntax4"> </span><span class="syntax4">to</span><span class="syntax4"> </span><span class="syntax4">process</span><span class="syntax4"> </span><span class="syntax4">and</span><span class="syntax4"> </span><span class="syntax4">there</span><span class="syntax4"> </span><span class="syntax4">is</span><span class="syntax4"> </span><span class="syntax4">anything</span><span class="syntax4"> </span><span class="syntax4">to</span><span class="syntax4"> </span><span class="syntax4">do,</span><span class="syntax4"> </span><span class="syntax4">do</span><span class="syntax4"> </span><span class="syntax4">it</span>
        <span class="syntax8">if</span><span class="syntax18">(</span><span class="syntax6">gp</span><span class="syntax18">(</span><span class="syntax13">'</span><span class="syntax13">process</span><span class="syntax13">'</span><span class="syntax18">)</span><span class="syntax18">=</span><span class="syntax18">=</span><span class="syntax5">1</span> <span class="syntax18">&amp;</span><span class="syntax18">&amp;</span> <span class="syntax9">count</span><span class="syntax18">(</span><span class="syntax10">$customers</span><span class="syntax18">)</span><span class="syntax18">&gt;</span><span class="syntax5">0</span><span class="syntax18">)</span> <span class="syntax18">{</span>
            <span class="syntax11">$this</span><span class="syntax6">-&gt;process</span><span class="syntax18">(</span><span class="syntax18">)</span><span class="syntax18">;</span>
            <span class="syntax4">#</span><span class="syntax4"> </span><span class="syntax4">refresh</span><span class="syntax4"> </span><span class="syntax4">the</span><span class="syntax4"> </span><span class="syntax4">counts,</span><span class="syntax4"> </span><span class="syntax4">they</span><span class="syntax4"> </span><span class="syntax4">should</span><span class="syntax4"> </span><span class="syntax4">all</span><span class="syntax4"> </span><span class="syntax4">come</span><span class="syntax4"> </span><span class="syntax4">to</span><span class="syntax4"> </span><span class="syntax4">zero</span>
            <span class="syntax8">list</span><span class="syntax18">(</span><span class="syntax10">$cnt_ol</span><span class="syntax18">,</span><span class="syntax10">$cnt_os</span><span class="syntax18">,</span><span class="syntax10">$customers</span><span class="syntax18">)</span> <span class="syntax18">=</span> <span class="syntax11">$this</span><span class="syntax6">-&gt;makeInquiries</span><span class="syntax18">(</span><span class="syntax18">)</span><span class="syntax18">;</span>
        <span class="syntax18">}</span>
        
        <span class="syntax4">#</span><span class="syntax4"> </span><span class="syntax4">Get</span><span class="syntax4"> </span><span class="syntax4">the</span><span class="syntax4"> </span><span class="syntax4">last</span><span class="syntax4"> </span><span class="syntax4">10</span><span class="syntax4"> </span><span class="syntax4">batches</span>
        <span class="syntax10">$batches</span> <span class="syntax18">=</span> <span class="syntax6">sql_allrows</span><span class="syntax18">(</span>
            <span class="syntax14">&quot;</span><span class="syntax14">Select</span><span class="syntax14"> </span><span class="syntax14">*</span><span class="syntax14"> </span><span class="syntax14">from</span><span class="syntax14"> </span><span class="syntax14">opbatches</span><span class="syntax14"> </span><span class="syntax14">ORDER</span><span class="syntax14"> </span><span class="syntax14">by</span><span class="syntax14"> </span><span class="syntax14">ts_ins</span><span class="syntax14"> </span><span class="syntax14">desc</span><span class="syntax14"> </span><span class="syntax14">limit</span><span class="syntax14"> </span><span class="syntax14">10</span><span class="syntax14">&quot;</span>
        <span class="syntax18">)</span><span class="syntax18">;</span>
        
        <span class="syntax17">?&gt;</span>
        <span class="syntax17">&lt;h1</span><span class="syntax17">&gt;</span>Bill Processing<span class="syntax17">&lt;/h1</span><span class="syntax17">&gt;</span>
        <span class="syntax17">&lt;hr</span><span class="syntax17">/</span><span class="syntax17">&gt;</span>
        
        <span class="syntax17">&lt;h2</span><span class="syntax17">&gt;</span>Preview Unbilled Lines<span class="syntax17">&lt;/h2</span><span class="syntax17">&gt;</span>

        <span class="syntax17">&lt;p</span><span class="syntax17">&gt;</span>There are <span class="syntax17">&lt;?</span><span class="syntax18">=</span><span class="syntax10">$cnt_ol</span><span class="syntax17">?&gt;</span> new order lines waiting for processing.
        <span class="syntax17">&lt;a</span><span class="syntax17"> </span><span class="syntax17">href</span><span class="syntax18">=</span><span class="syntax14">&quot;</span><span class="syntax14">?</span><span class="syntax14">gp_page</span><span class="syntax14">=</span><span class="syntax14">billproc_openl</span><span class="syntax14">&quot;</span><span class="syntax17">&gt;</span>Click here to view<span class="syntax17">&lt;/a</span><span class="syntax17">&gt;</span>.<span class="syntax17">&lt;/p</span><span class="syntax17">&gt;</span>
        
        <span class="syntax17">&lt;p</span><span class="syntax17">&gt;</span>There are <span class="syntax17">&lt;?</span><span class="syntax18">=</span><span class="syntax10">$cnt_os</span><span class="syntax17">?&gt;</span> new order services waiting for processing.
        <span class="syntax17">&lt;a</span><span class="syntax17"> </span><span class="syntax17">href</span><span class="syntax18">=</span><span class="syntax14">&quot;</span><span class="syntax14">?</span><span class="syntax14">gp_page</span><span class="syntax14">=</span><span class="syntax14">billproc_opens</span><span class="syntax14">&quot;</span><span class="syntax17">&gt;</span>Click here to view<span class="syntax17">&lt;/a</span><span class="syntax17">&gt;</span>.<span class="syntax17">&lt;/p</span><span class="syntax17">&gt;</span>
        
        <span class="syntax17">&lt;hr</span><span class="syntax17">/</span><span class="syntax17">&gt;</span>
        <span class="syntax17">&lt;h2</span><span class="syntax17">&gt;</span>Automatically Generate Orders<span class="syntax17">&lt;/h2</span><span class="syntax17">&gt;</span>

        <span class="syntax17">&lt;p</span><span class="syntax17">&gt;</span>This program will automatically generate orders for all customers
            that require them, and assign the order lines and services to
            those new orders.
        <span class="syntax17">&lt;/p</span><span class="syntax17">&gt;</span>
        
        <span class="syntax17">&lt;p</span><span class="syntax17">&gt;</span>There are <span class="syntax17">&lt;?</span><span class="syntax18">=</span><span class="syntax10">$cnt_ol</span><span class="syntax17">?&gt;</span> order lines and <span class="syntax17">&lt;?</span><span class="syntax18">=</span><span class="syntax10">$cnt_os</span><span class="syntax17">?&gt;</span> order services
           that will be processed.  The customers who will get orders are:<span class="syntax17">&lt;/p</span><span class="syntax17">&gt;</span>
        
        
        <span class="syntax17">&lt;?php</span> <span class="syntax8">foreach</span><span class="syntax18">(</span><span class="syntax10">$customers</span> <span class="syntax8">as</span> <span class="syntax10">$customer</span><span class="syntax18">)</span> <span class="syntax18">{</span> <span class="syntax17">?&gt;</span>
        <span class="syntax17">&lt;a</span><span class="syntax17"> </span><span class="syntax17">href</span><span class="syntax18">=</span><span class="syntax14">&quot;</span><span class="syntax14">?</span><span class="syntax14">gp_page</span><span class="syntax14">=</span><span class="syntax14">customers</span><span class="syntax14">&amp;</span><span class="syntax14">gp_skey</span><span class="syntax14">=</span><span class="syntax17">&lt;?</span><span class="syntax18">=</span><span class="syntax10">$customer</span><span class="syntax18">[</span><span class="syntax13">'</span><span class="syntax13">skey</span><span class="syntax13">'</span><span class="syntax18">]</span><span class="syntax17">?&gt;</span><span class="syntax14">&quot;</span>
<span class="syntax17"> </span><span class="syntax17"> </span><span class="syntax17"> </span><span class="syntax17"> </span><span class="syntax17"> </span><span class="syntax17"> </span><span class="syntax17"> </span><span class="syntax17"> </span><span class="syntax17">&gt;</span><span class="syntax17">&lt;?</span><span class="syntax18">=</span><span class="syntax10">$customer</span><span class="syntax18">[</span><span class="syntax13">'</span><span class="syntax13">customer</span><span class="syntax13">'</span><span class="syntax18">]</span><span class="syntax17">?&gt;</span><span class="syntax17">&lt;/a</span><span class="syntax17">&gt;</span> - <span class="syntax17">&lt;?</span><span class="syntax18">=</span><span class="syntax10">$customer</span><span class="syntax18">[</span><span class="syntax13">'</span><span class="syntax13">description</span><span class="syntax13">'</span><span class="syntax18">]</span><span class="syntax17">?&gt;</span><span class="syntax17">&lt;br</span><span class="syntax17">/</span><span class="syntax17">&gt;</span>
        <span class="syntax17">&lt;?php</span> <span class="syntax18">}</span> <span class="syntax17">?&gt;</span>

        <span class="syntax17">&lt;br</span><span class="syntax17">/</span><span class="syntax17">&gt;</span>
        <span class="syntax17">&lt;br</span><span class="syntax17">/</span><span class="syntax17">&gt;</span>
        <span class="syntax17">&lt;p</span><span class="syntax17">&gt;</span><span class="syntax17">&lt;a</span><span class="syntax17"> </span><span class="syntax17">href</span><span class="syntax18">=</span><span class="syntax14">&quot;</span><span class="syntax14">?</span><span class="syntax14">gp_page</span><span class="syntax14">=</span><span class="syntax14">billproc</span><span class="syntax14">&amp;</span><span class="syntax14">process</span><span class="syntax14">=</span><span class="syntax14">1</span><span class="syntax14">&quot;</span><span class="syntax17">?</span><span class="syntax17">&gt;</span>Process Now<span class="syntax17">&lt;/a</span><span class="syntax17">&gt;</span><span class="syntax17">&lt;/p</span><span class="syntax17">&gt;</span>
        
        <span class="syntax17">&lt;hr</span><span class="syntax17">/</span><span class="syntax17">&gt;</span>
        <span class="syntax17">&lt;h2</span><span class="syntax17">&gt;</span>Print Recent Orders<span class="syntax17">&lt;/h2</span><span class="syntax17">&gt;</span>
        
        <span class="syntax17">&lt;p</span><span class="syntax17">&gt;</span>These are the most recent batches that were generated,
           along with their most recent printing times.
        <span class="syntax17">&lt;/p</span><span class="syntax17">&gt;</span>
        
        <span class="syntax17">&lt;table</span><span class="syntax17"> </span><span class="syntax17">id</span><span class="syntax18">=</span><span class="syntax14">&quot;</span><span class="syntax14">x2data1</span><span class="syntax14">&quot;</span><span class="syntax17">&gt;</span>
            <span class="syntax17">&lt;thead</span><span class="syntax17">&gt;</span>
            <span class="syntax17">&lt;tr</span><span class="syntax17">&gt;</span>
                <span class="syntax17">&lt;th</span><span class="syntax17">&gt;</span>Batch
                <span class="syntax17">&lt;th</span><span class="syntax17">&gt;</span>Created
                <span class="syntax17">&lt;th</span><span class="syntax17">&gt;</span>User
                <span class="syntax17">&lt;th</span><span class="syntax17">&gt;</span>Last Printed
                <span class="syntax17">&lt;th</span><span class="syntax17">&gt;</span>Print Now
            <span class="syntax17">&lt;/thead</span><span class="syntax17">&gt;</span>
        <span class="syntax17">&lt;?php</span>
        <span class="syntax8">if</span><span class="syntax18">(</span><span class="syntax9">count</span><span class="syntax18">(</span><span class="syntax10">$batches</span><span class="syntax18">)</span><span class="syntax18">=</span><span class="syntax18">=</span><span class="syntax5">0</span><span class="syntax18">)</span> <span class="syntax18">{</span>
            <span class="syntax8">echo</span> <span class="syntax14">&quot;</span><span class="syntax14">&lt;</span><span class="syntax14">tr</span><span class="syntax14">&gt;</span><span class="syntax14">&lt;</span><span class="syntax14">td</span><span class="syntax14"> </span><span class="syntax14">colspan</span><span class="syntax14">=</span><span class="syntax14">5</span><span class="syntax14">&gt;</span><span class="syntax14">&lt;</span><span class="syntax14">b</span><span class="syntax14">&gt;</span><span class="syntax14">No</span><span class="syntax14"> </span><span class="syntax14">Batches</span><span class="syntax14"> </span><span class="syntax14">Available</span><span class="syntax14">&lt;</span><span class="syntax14">/</span><span class="syntax14">b</span><span class="syntax14">&gt;</span><span class="syntax14">&lt;</span><span class="syntax14">/</span><span class="syntax14">td</span><span class="syntax14">&gt;</span><span class="syntax14">&lt;</span><span class="syntax14">/</span><span class="syntax14">tr</span><span class="syntax14">&gt;</span><span class="syntax14">&quot;</span><span class="syntax18">;</span>
        <span class="syntax18">}</span>
        <span class="syntax8">else</span> <span class="syntax18">{</span>
            <span class="syntax8">foreach</span><span class="syntax18">(</span><span class="syntax10">$batches</span> <span class="syntax8">as</span> <span class="syntax10">$batch</span><span class="syntax18">)</span> <span class="syntax18">{</span>
                <span class="syntax17">?&gt;</span>
                <span class="syntax17">&lt;tr</span><span class="syntax17">&gt;</span>
                <span class="syntax17">&lt;td</span><span class="syntax17">&gt;</span> <span class="syntax17">&lt;?</span><span class="syntax18">=</span> <span class="syntax10">$batch</span><span class="syntax18">[</span><span class="syntax13">'</span><span class="syntax13">recnum_op</span><span class="syntax13">'</span><span class="syntax18">]</span><span class="syntax18">;</span><span class="syntax17">?&gt;</span>
                <span class="syntax17">&lt;td</span><span class="syntax17">&gt;</span> <span class="syntax17">&lt;?</span><span class="syntax18">=</span> <span class="syntax6">hDate</span><span class="syntax18">(</span><span class="syntax10">$batch</span><span class="syntax18">[</span><span class="syntax13">'</span><span class="syntax13">ts_ins</span><span class="syntax13">'</span><span class="syntax18">]</span><span class="syntax18">)</span><span class="syntax17">?&gt;</span>
                <span class="syntax17">&lt;td</span><span class="syntax17">&gt;</span> <span class="syntax17">&lt;?</span><span class="syntax18">=</span> <span class="syntax10">$batch</span><span class="syntax18">[</span><span class="syntax13">'</span><span class="syntax13">uid_ins</span><span class="syntax13">'</span><span class="syntax18">]</span><span class="syntax18">;</span> <span class="syntax17">?&gt;</span>
                <span class="syntax17">&lt;td</span><span class="syntax17">&gt;</span> <span class="syntax17">&lt;?</span><span class="syntax18">=</span> <span class="syntax6">hDate</span><span class="syntax18">(</span><span class="syntax10">$batch</span><span class="syntax18">[</span><span class="syntax13">'</span><span class="syntax13">date_print</span><span class="syntax13">'</span><span class="syntax18">]</span><span class="syntax18">)</span><span class="syntax18">;</span> <span class="syntax17">?&gt;</span>
                <span class="syntax17">&lt;td</span><span class="syntax17">&gt;</span> <span class="syntax17">&lt;a</span><span class="syntax17"> </span><span class="syntax17">href</span><span class="syntax18">=</span><span class="syntax14">&quot;</span><span class="syntax14">?</span><span class="syntax14">gp_page</span><span class="syntax14">=</span><span class="syntax14">p_orders</span><span class="syntax14">&amp;</span><span class="syntax14">batch</span><span class="syntax14">=</span><span class="syntax17">&lt;?</span><span class="syntax18">=</span><span class="syntax10">$batch</span><span class="syntax18">[</span><span class="syntax13">'</span><span class="syntax13">recnum_op</span><span class="syntax13">'</span><span class="syntax18">]</span><span class="syntax17">?&gt;</span><span class="syntax14">&quot;</span>
<span class="syntax17"> </span><span class="syntax17"> </span><span class="syntax17"> </span><span class="syntax17"> </span><span class="syntax17"> </span><span class="syntax17"> </span><span class="syntax17"> </span><span class="syntax17"> </span><span class="syntax17"> </span><span class="syntax17"> </span><span class="syntax17"> </span><span class="syntax17"> </span><span class="syntax17"> </span><span class="syntax17"> </span><span class="syntax17"> </span><span class="syntax17"> </span><span class="syntax17"> </span><span class="syntax17"> </span><span class="syntax17"> </span><span class="syntax17">&gt;</span>Print Now<span class="syntax17">&lt;/a</span><span class="syntax17">&gt;</span>
                <span class="syntax17">&lt;?php</span>
            <span class="syntax18">}</span>        
        <span class="syntax18">}</span>
        <span class="syntax8">echo</span> <span class="syntax14">&quot;</span><span class="syntax14">&lt;</span><span class="syntax14">/</span><span class="syntax14">table</span><span class="syntax14">&gt;</span><span class="syntax14">&quot;</span><span class="syntax18">;</span> 
    <span class="syntax18">}</span>
    
    <span class="syntax4">#</span><span class="syntax4"> </span><span class="syntax4">===================================================================</span>
    <span class="syntax4">#</span>
    <span class="syntax4">#</span><span class="syntax4"> </span><span class="syntax4">Make</span><span class="syntax4"> </span><span class="syntax4">inquiries:</span><span class="syntax4"> </span><span class="syntax4">find</span><span class="syntax4"> </span><span class="syntax4">out</span><span class="syntax4"> </span><span class="syntax4">what</span><span class="syntax4"> </span><span class="syntax4">is</span><span class="syntax4"> </span><span class="syntax4">available</span><span class="syntax4"> </span><span class="syntax4">to</span><span class="syntax4"> </span><span class="syntax4">process</span>
    <span class="syntax4">#</span>
    <span class="syntax4">#</span><span class="syntax4"> </span><span class="syntax4">===================================================================</span>
    <span class="syntax8">function</span> <span class="syntax6">makeInquiries</span><span class="syntax18">(</span><span class="syntax18">)</span> <span class="syntax18">{</span>
        <span class="syntax2">//</span><span class="syntax2"> </span><span class="syntax2">Get</span>
        <span class="syntax10">$cnt_ol</span> <span class="syntax18">=</span> <span class="syntax6">SQL_oneValue</span><span class="syntax18">(</span><span class="syntax13">'</span><span class="syntax13">cnt</span><span class="syntax13">'</span><span class="syntax18">,</span>
            <span class="syntax14">&quot;</span><span class="syntax14">Select</span><span class="syntax14"> </span><span class="syntax14">COUNT</span><span class="syntax14">(</span><span class="syntax14">*</span><span class="syntax14">)</span><span class="syntax14"> </span><span class="syntax14">as</span><span class="syntax14"> </span><span class="syntax14">cnt</span><span class="syntax14"> </span><span class="syntax14">FROM</span><span class="syntax14"> </span><span class="syntax14">orderlines</span><span class="syntax14"> </span><span class="syntax14">where</span><span class="syntax14"> </span><span class="syntax14">recnum_ord</span><span class="syntax14"> </span><span class="syntax14">is</span><span class="syntax14"> </span><span class="syntax14">null</span><span class="syntax14">&quot;</span>
        <span class="syntax18">)</span><span class="syntax18">;</span>
        <span class="syntax10">$cnt_os</span> <span class="syntax18">=</span> <span class="syntax6">SQL_oneValue</span><span class="syntax18">(</span><span class="syntax13">'</span><span class="syntax13">cnt</span><span class="syntax13">'</span><span class="syntax18">,</span>
            <span class="syntax14">&quot;</span><span class="syntax14">Select</span><span class="syntax14"> </span><span class="syntax14">COUNT</span><span class="syntax14">(</span><span class="syntax14">*</span><span class="syntax14">)</span><span class="syntax14"> </span><span class="syntax14">as</span><span class="syntax14"> </span><span class="syntax14">cnt</span><span class="syntax14"> </span><span class="syntax14">FROM</span><span class="syntax14"> </span><span class="syntax14">orderservices</span><span class="syntax14"> </span><span class="syntax14">where</span><span class="syntax14"> </span><span class="syntax14">recnum_ord</span><span class="syntax14"> </span><span class="syntax14">is</span><span class="syntax14"> </span><span class="syntax14">null</span><span class="syntax14">&quot;</span>
        <span class="syntax18">)</span><span class="syntax18">;</span>
        <span class="syntax10">$customers</span> <span class="syntax18">=</span> <span class="syntax6">SQL_AllRows</span><span class="syntax18">(</span>
            <span class="syntax14">&quot;</span><span class="syntax14">Select</span><span class="syntax14"> </span><span class="syntax14">cu</span><span class="syntax14">.</span><span class="syntax14">skey</span><span class="syntax14">,</span><span class="syntax14">cu</span><span class="syntax14">.</span><span class="syntax14">description</span><span class="syntax14">,</span><span class="syntax14">c</span><span class="syntax14">.</span><span class="syntax14">customer</span>
<span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14">FROM</span><span class="syntax14"> </span><span class="syntax14">customers</span><span class="syntax14"> </span><span class="syntax14">cu</span>
<span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14">JOIN</span><span class="syntax14"> </span><span class="syntax14">(</span><span class="syntax14">Select</span><span class="syntax14"> </span><span class="syntax14">customer</span><span class="syntax14"> </span><span class="syntax14">from</span><span class="syntax14"> </span><span class="syntax14">orderlines</span><span class="syntax14"> </span><span class="syntax14">where</span><span class="syntax14"> </span><span class="syntax14">recnuM_ord</span><span class="syntax14"> </span><span class="syntax14">is</span><span class="syntax14"> </span><span class="syntax14">null</span>
<span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14">UNION</span>
<span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14">SELECT</span><span class="syntax14"> </span><span class="syntax14">customer</span><span class="syntax14"> </span><span class="syntax14">from</span><span class="syntax14"> </span><span class="syntax14">orderservices</span><span class="syntax14"> </span><span class="syntax14">where</span><span class="syntax14"> </span><span class="syntax14">recnum_ord</span><span class="syntax14"> </span><span class="syntax14">is</span><span class="syntax14"> </span><span class="syntax14">null</span>
<span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14">)</span><span class="syntax14"> </span><span class="syntax14">c</span><span class="syntax14"> </span><span class="syntax14">ON</span><span class="syntax14"> </span><span class="syntax14">cu</span><span class="syntax14">.</span><span class="syntax14">customer</span><span class="syntax14"> </span><span class="syntax14">=</span><span class="syntax14"> </span><span class="syntax14">c</span><span class="syntax14">.</span><span class="syntax14">customer</span><span class="syntax14">&quot;</span>
        <span class="syntax18">)</span><span class="syntax18">;</span>
        
        <span class="syntax8">return</span> <span class="syntax8">array</span><span class="syntax18">(</span><span class="syntax10">$cnt_ol</span><span class="syntax18">,</span><span class="syntax10">$cnt_os</span><span class="syntax18">,</span><span class="syntax10">$customers</span><span class="syntax18">)</span><span class="syntax18">;</span>
    <span class="syntax18">}</span>

    <span class="syntax4">#</span><span class="syntax4"> </span><span class="syntax4">===================================================================</span>
    <span class="syntax4">#</span>
    <span class="syntax4">#</span><span class="syntax4"> </span><span class="syntax4">Processing</span><span class="syntax4"> </span><span class="syntax4">Code:</span><span class="syntax4"> </span><span class="syntax4">Generate</span><span class="syntax4"> </span><span class="syntax4">new</span><span class="syntax4"> </span><span class="syntax4">orders</span>
    <span class="syntax4">#</span>
    <span class="syntax4">#</span><span class="syntax4"> </span><span class="syntax4">===================================================================</span>
    <span class="syntax8">function</span> <span class="syntax9">process</span><span class="syntax18">(</span><span class="syntax18">)</span> <span class="syntax18">{</span>
        <span class="syntax2">//</span><span class="syntax2"> </span><span class="syntax2">Step</span><span class="syntax2"> </span><span class="syntax2">0,</span><span class="syntax2"> </span><span class="syntax2">create</span><span class="syntax2"> </span><span class="syntax2">a</span><span class="syntax2"> </span><span class="syntax2">new</span><span class="syntax2"> </span><span class="syntax2">batch</span>
        <span class="syntax6">SQLX_TrxBegin</span><span class="syntax18">(</span><span class="syntax18">)</span><span class="syntax18">;</span>
        <span class="syntax10">$row</span><span class="syntax18">=</span><span class="syntax8">array</span><span class="syntax18">(</span><span class="syntax13">'</span><span class="syntax13">skey_quiet</span><span class="syntax13">'</span><span class="syntax18">=</span><span class="syntax18">&gt;</span><span class="syntax13">'</span><span class="syntax13">N</span><span class="syntax13">'</span><span class="syntax18">)</span><span class="syntax18">;</span>
        <span class="syntax10">$skey</span><span class="syntax18">=</span><span class="syntax6">SQLX_Insert</span><span class="syntax18">(</span><span class="syntax13">'</span><span class="syntax13">opbatches</span><span class="syntax13">'</span><span class="syntax18">,</span><span class="syntax10">$row</span><span class="syntax18">)</span><span class="syntax18">;</span>
        <span class="syntax10">$batch</span> <span class="syntax18">=</span> <span class="syntax6">SQL_oneValue</span><span class="syntax18">(</span><span class="syntax14">&quot;</span><span class="syntax14">recnum_op</span><span class="syntax14">&quot;</span><span class="syntax18">,</span>
            <span class="syntax14">&quot;</span><span class="syntax14">Select</span><span class="syntax14"> </span><span class="syntax14">recnum_op</span><span class="syntax14"> </span><span class="syntax14">from</span><span class="syntax14"> </span><span class="syntax14">opbatches</span><span class="syntax14"> </span><span class="syntax14">where</span><span class="syntax14"> </span><span class="syntax14">skey</span><span class="syntax14"> </span><span class="syntax14">=</span><span class="syntax14"> </span><span class="syntax10">$skey</span><span class="syntax14">&quot;</span>
        <span class="syntax18">)</span><span class="syntax18">;</span>
        
        <span class="syntax2">//</span><span class="syntax2"> </span><span class="syntax2">Step</span><span class="syntax2"> </span><span class="syntax2">1,</span><span class="syntax2"> </span><span class="syntax2">create</span><span class="syntax2"> </span><span class="syntax2">empty</span><span class="syntax2"> </span><span class="syntax2">orders</span><span class="syntax2"> </span><span class="syntax2">for</span><span class="syntax2"> </span><span class="syntax2">all</span><span class="syntax2"> </span><span class="syntax2">customers</span>
        <span class="syntax2">//</span><span class="syntax2"> </span><span class="syntax2">that</span><span class="syntax2"> </span><span class="syntax2">need</span><span class="syntax2"> </span><span class="syntax2">them</span>
        <span class="syntax10">$sq</span><span class="syntax18">=</span><span class="syntax14">&quot;</span><span class="syntax14">INSERT</span><span class="syntax14"> </span><span class="syntax14">INTO</span><span class="syntax14"> </span><span class="syntax14">ORDERS</span><span class="syntax14"> </span><span class="syntax14">(</span><span class="syntax14">customer</span><span class="syntax14">,</span><span class="syntax14">recnum_op</span><span class="syntax14">)</span>
<span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14">SELECT</span><span class="syntax14"> </span><span class="syntax14">customer</span><span class="syntax14">,</span><span class="syntax10">$batch</span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14">from</span>
<span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14">(</span><span class="syntax14"> </span><span class="syntax14">select</span><span class="syntax14"> </span><span class="syntax14">customer</span><span class="syntax14"> </span><span class="syntax14">from</span><span class="syntax14"> </span><span class="syntax14">orderlines</span>
<span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14">where</span><span class="syntax14"> </span><span class="syntax14">recnum_ord</span><span class="syntax14"> </span><span class="syntax14">is</span><span class="syntax14"> </span><span class="syntax14">null</span>
<span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14">UNION</span>
<span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14">Select</span><span class="syntax14"> </span><span class="syntax14">customer</span><span class="syntax14"> </span><span class="syntax14">from</span><span class="syntax14"> </span><span class="syntax14">orderservices</span>
<span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14">where</span><span class="syntax14"> </span><span class="syntax14">recnum_ord</span><span class="syntax14"> </span><span class="syntax14">is</span><span class="syntax14"> </span><span class="syntax14">null</span><span class="syntax14">)</span><span class="syntax14"> </span><span class="syntax14">x</span><span class="syntax14">&quot;</span><span class="syntax18">;</span>
        <span class="syntax6">SQL</span><span class="syntax18">(</span><span class="syntax10">$sq</span><span class="syntax18">)</span><span class="syntax18">;</span>
        
        <span class="syntax2">//</span><span class="syntax2"> </span><span class="syntax2">Step</span><span class="syntax2"> </span><span class="syntax2">2,</span><span class="syntax2"> </span><span class="syntax2">now</span><span class="syntax2"> </span><span class="syntax2">assign</span><span class="syntax2"> </span><span class="syntax2">the</span><span class="syntax2"> </span><span class="syntax2">order</span><span class="syntax2"> </span><span class="syntax2">number</span><span class="syntax2"> </span><span class="syntax2">to</span><span class="syntax2"> </span><span class="syntax2">order</span><span class="syntax2"> </span><span class="syntax2">lines</span><span class="syntax2"> </span><span class="syntax2">and</span><span class="syntax2"> </span><span class="syntax2">services</span>
        <span class="syntax10">$sq</span> <span class="syntax18">=</span> <span class="syntax14">&quot;</span><span class="syntax14">UPDATE</span><span class="syntax14"> </span><span class="syntax14">ORDERLINES</span><span class="syntax14"> </span><span class="syntax14">set</span><span class="syntax14"> </span><span class="syntax14">recnum_ord</span><span class="syntax14"> </span><span class="syntax14">=</span><span class="syntax14"> </span><span class="syntax14">x</span><span class="syntax14">.</span><span class="syntax14">recnum_ord</span>
<span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14">FROM</span><span class="syntax14"> </span><span class="syntax14">(</span><span class="syntax14">SELECT</span><span class="syntax14"> </span><span class="syntax14">recnum_ord</span><span class="syntax14">,</span><span class="syntax14">customer</span>
<span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14">FROM</span><span class="syntax14"> </span><span class="syntax14">orders</span>
<span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14">WHERE</span><span class="syntax14"> </span><span class="syntax14">recnum_op</span><span class="syntax14"> </span><span class="syntax14">=</span><span class="syntax14"> </span><span class="syntax10">$batch</span>
<span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14">)</span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14">x</span>
<span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14">WHERE</span><span class="syntax14"> </span><span class="syntax14">orderlines</span><span class="syntax14">.</span><span class="syntax14">customer</span><span class="syntax14"> </span><span class="syntax14">=</span><span class="syntax14"> </span><span class="syntax14">x</span><span class="syntax14">.</span><span class="syntax14">customer</span>
<span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14">AND</span><span class="syntax14"> </span><span class="syntax14">orderlines</span><span class="syntax14">.</span><span class="syntax14">recnum_ord</span><span class="syntax14"> </span><span class="syntax14">IS</span><span class="syntax14"> </span><span class="syntax14">NULL</span><span class="syntax14">&quot;</span><span class="syntax18">;</span>
        <span class="syntax6">SQL</span><span class="syntax18">(</span><span class="syntax10">$sq</span><span class="syntax18">)</span><span class="syntax18">;</span>
        <span class="syntax10">$sq</span> <span class="syntax18">=</span> <span class="syntax14">&quot;</span><span class="syntax14">UPDATE</span><span class="syntax14"> </span><span class="syntax14">ORDERSERVICES</span><span class="syntax14"> </span><span class="syntax14">set</span><span class="syntax14"> </span><span class="syntax14">recnum_ord</span><span class="syntax14"> </span><span class="syntax14">=</span><span class="syntax14"> </span><span class="syntax14">x</span><span class="syntax14">.</span><span class="syntax14">recnum_ord</span>
<span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14">FROM</span><span class="syntax14"> </span><span class="syntax14">(</span><span class="syntax14">SELECT</span><span class="syntax14"> </span><span class="syntax14">recnum_ord</span><span class="syntax14">,</span><span class="syntax14">customer</span>
<span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14">FROM</span><span class="syntax14"> </span><span class="syntax14">orders</span>
<span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14">WHERE</span><span class="syntax14"> </span><span class="syntax14">recnum_op</span><span class="syntax14"> </span><span class="syntax14">=</span><span class="syntax14"> </span><span class="syntax10">$batch</span>
<span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14">)</span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14">x</span>
<span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14">WHERE</span><span class="syntax14"> </span><span class="syntax14">orderservices</span><span class="syntax14">.</span><span class="syntax14">customer</span><span class="syntax14"> </span><span class="syntax14">=</span><span class="syntax14"> </span><span class="syntax14">x</span><span class="syntax14">.</span><span class="syntax14">customer</span>
<span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14">AND</span><span class="syntax14"> </span><span class="syntax14">orderservices</span><span class="syntax14">.</span><span class="syntax14">recnum_ord</span><span class="syntax14"> </span><span class="syntax14">IS</span><span class="syntax14"> </span><span class="syntax14">NULL</span><span class="syntax14">&quot;</span><span class="syntax18">;</span>
        <span class="syntax6">SQL</span><span class="syntax18">(</span><span class="syntax10">$sq</span><span class="syntax18">)</span><span class="syntax18">;</span>
        
        <span class="syntax2">//</span><span class="syntax2"> </span><span class="syntax2">Step</span><span class="syntax2"> </span><span class="syntax2">3,</span><span class="syntax2"> </span><span class="syntax2">recalculate</span><span class="syntax2"> </span><span class="syntax2">all</span><span class="syntax2"> </span><span class="syntax2">empty</span><span class="syntax2"> </span><span class="syntax2">orders.</span><span class="syntax2"> </span><span class="syntax2"> </span><span class="syntax2">Andromeda</span><span class="syntax2"> </span><span class="syntax2">does</span><span class="syntax2"> </span><span class="syntax2">not</span>
        <span class="syntax2">//</span><span class="syntax2"> </span><span class="syntax2"> </span><span class="syntax2"> </span><span class="syntax2"> </span><span class="syntax2"> </span><span class="syntax2"> </span><span class="syntax2"> </span><span class="syntax2"> </span><span class="syntax2"> </span><span class="syntax2">yet</span><span class="syntax2"> </span><span class="syntax2">know</span><span class="syntax2"> </span><span class="syntax2">what</span><span class="syntax2"> </span><span class="syntax2">to</span><span class="syntax2"> </span><span class="syntax2">do</span><span class="syntax2"> </span><span class="syntax2">when</span><span class="syntax2"> </span><span class="syntax2">a</span><span class="syntax2"> </span><span class="syntax2">foreign</span><span class="syntax2"> </span><span class="syntax2">key</span><span class="syntax2"> </span><span class="syntax2">changes</span>
        <span class="syntax10">$sq</span> <span class="syntax18">=</span> <span class="syntax14">&quot;</span><span class="syntax14">UPDATE</span><span class="syntax14"> </span><span class="syntax14">orders</span><span class="syntax14"> </span><span class="syntax14">SET</span><span class="syntax14"> </span><span class="syntax14">_agg</span><span class="syntax14">=</span><span class="syntax14">'</span><span class="syntax14">C</span><span class="syntax14">'</span><span class="syntax14"> </span><span class="syntax14">where</span><span class="syntax14"> </span><span class="syntax14">recnum_op</span><span class="syntax14"> </span><span class="syntax14">=</span><span class="syntax14"> </span><span class="syntax10">$batch</span><span class="syntax14">&quot;</span><span class="syntax18">;</span>
        <span class="syntax6">SQL</span><span class="syntax18">(</span><span class="syntax10">$sq</span><span class="syntax18">)</span><span class="syntax18">;</span>
        <span class="syntax6">SQLX_TrxClose</span><span class="syntax18">(</span><span class="syntax18">)</span><span class="syntax18">;</span>
    <span class="syntax18">}</span>
<span class="syntax18">}</span>
<span class="syntax17">?&gt;</span>
</span></pre>
</body>
</html>


            <h1>Security</h1>
                            
                            <p>May 22, 2007<br/><br/><br/>Security in Andromeda is entirely table-based.  The user interface
(web pages) are meant to reflect the priveleges that any particular
user has within the database.  For instance, if they are allowed to
work at all with the ORDERS table, they will see a menu entry "Orders".
</p>
<p>If they are allowed to INSERT into the ORDERS table, the "New Entry"
and "Import" buttons will be lit.  If they are allowed to update, the
textboxes on the detail screen will be enabled, otherwise they will
be disabled.
</p>
<p>Andromeda connects users to the database with their own credentials, it
does not connect as a super-user and arbitrate security in code.  For this
reason, we have no need to obfuscate our HTTP parameter schemes, and in
principle we do not even need to prevent SQL Injection!  If a malicious
user works out the parameter scheme and types in a URL meant to make
an update to a table, and they are not allowed to UPDATE that table, they
will just see a database error.
</p>
<h1>Public Accounts</h1>
<p>Every database has a public group and user.  By default Andromeda
denies access to all tables to all groups, so this user can do nothing
unless explicitly granted.  The deny-by-default policy can be a hassle
when making public web sites, where lots of anonymous access is required,
so in those kinds of sites the public user is given at very least SELECT
priveleges to the public tables.
</p>
<h1>Point-of-Sale Security</h1>
<p>Point-of-Sale (POS) systems have special security requirements, and cannot use
the security model of either a public web site or something like an
accounting system.
</p>
<p>A POS system requires that users identify themselves
every time they perform certain tasks, the normal concept of "Logging in"
in the morning and staying logged in all day really does not apply.
Each time a salesperson goes to enter an order, they must identify themselves.
</p>
<p>There are two reasons for this.  First, the computer is often in a public
or semi-public place, and it may not be possible to keep it attended at
all times.  Second, the computer may be shared by multiple staff members,
and it would be burdensome to ask them to keep logging in and out every time
they walked up to the machine.
</p>
<p>POS security does not require any particular settings in the
<span class="nolink">Database Specification</span>, it is all about the User Interface.
</p>
<p>When POS Security is activated, authentication is required in either of
these two circumstances:
</p>
<ul><li> When the user goes from one page to another (See [[Pages, Classes, and Tables]]).
<li> When any PHP code executes the [[POSClear]] function.
</ul>
<p>A super user is exempt from POS Security, it will be deactivated for
a super-user.
</p>
<p>You can activate POS security by making the following setting in
[[applib.php]].
</p>


<div id='example'><div id='extitle'>Activating Point-of-Sale Security</div>
<div id='exampleinner'><div id='ex2title'>PHP Code:</div>
<code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /></span><span style="color: #FF8000">//&nbsp;File&nbsp;applib.php,&nbsp;application&nbsp;library&nbsp;for&nbsp;my&nbsp;application<br /></span><span style="color: #0000BB">vgaSet</span><span style="color: #007700">(</span><span style="color: #DD0000">'POS_SECURITY'</span><span style="color: #007700">,</span><span style="color: #0000BB">true</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code>
</div></div>
<p>You can require re-authentication at the completion of some items with
explicit code:
</p>


<div id='example'><div id='extitle'>Explicitly requiring re-authentication</div>
<div id='exampleinner'><div id='ex2title'>PHP Code:</div>
<code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /></span><span style="color: #007700">class&nbsp;</span><span style="color: #0000BB">special_action&nbsp;</span><span style="color: #007700">extends&nbsp;</span><span style="color: #0000BB">x_table2&nbsp;</span><span style="color: #007700">{<br />&nbsp;&nbsp;&nbsp;function&nbsp;</span><span style="color: #0000BB">main</span><span style="color: #007700">()&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;Special&nbsp;code&nbsp;to&nbsp;give&nbsp;myself&nbsp;a&nbsp;bonus<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$row</span><span style="color: #007700">=array(</span><span style="color: #DD0000">'user_id'</span><span style="color: #007700">=&gt;</span><span style="color: #0000BB">SessionGet</span><span style="color: #007700">(</span><span style="color: #DD0000">'UID'</span><span style="color: #007700">),</span><span style="color: #DD0000">'dollars'</span><span style="color: #007700">=&gt;</span><span style="color: #0000BB">1000</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">SQLX_Insert</span><span style="color: #007700">(</span><span style="color: #DD0000">"bonuses"</span><span style="color: #007700">,</span><span style="color: #0000BB">$row</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;Don't&nbsp;let&nbsp;the&nbsp;next&nbsp;person&nbsp;do&nbsp;this,&nbsp;they&nbsp;have&nbsp;to&nbsp;authenticate&nbsp;again<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;even&nbsp;if&nbsp;coming&nbsp;back&nbsp;to&nbsp;the&nbsp;same&nbsp;page.<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">POSClear</span><span style="color: #007700">();<br />&nbsp;&nbsp;&nbsp;}<br />}<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code>
</div></div>
<p> 
</p>                                                    
                            
<h1>Returning Script with JSON</h1>

<p>It may be that you wish to have some bit of javascript
   execute when your JSON call is returned to the browser.
   You can do this with the x6script() function, which 
   takes as its argument a fragment of Javascript that will
   execute on the browser.
</p>

<p>The example below is identical to the prior page, except
   for the very last line, which adds script to the JSON
   return payload.
<p>

<pre><span class="syntax0"><span class="syntax17">&lt;?php</span>
<span class="syntax8">class</span><span class="syntax8"> </span><span class="syntax11">x6jsonexample</span><span class="syntax11"> </span><span class="syntax8">extends</span><span class="syntax11"> </span><span class="syntax11">androX6</span><span class="syntax11"> </span><span class="syntax18">{</span>
    <span class="syntax8">function</span> <span class="syntax6">x6main</span><span class="syntax18">(</span><span class="syntax18">)</span> <span class="syntax18">{</span>
        <span class="syntax4">#</span><span class="syntax4"> </span><span class="syntax4">Conventional</span><span class="syntax4"> </span><span class="syntax4">HTML</span><span class="syntax4"> </span><span class="syntax4">generation...</span>
        <span class="syntax10">$top</span> <span class="syntax18">=</span> <span class="syntax17">html</span><span class="syntax18">(</span><span class="syntax13">'</span><span class="syntax13">div</span><span class="syntax13">'</span><span class="syntax18">)</span><span class="syntax18">;</span>
        <span class="syntax11">$top</span><span class="syntax6">-&gt;h</span><span class="syntax18">(</span><span class="syntax13">'</span><span class="syntax13">h1</span><span class="syntax13">'</span><span class="syntax18">,</span><span class="syntax13">'</span><span class="syntax13">Hello</span><span class="syntax13"> </span><span class="syntax13">JSON!</span><span class="syntax13">'</span><span class="syntax18">)</span><span class="syntax18">;</span>
        <span class="syntax11">$top</span><span class="syntax6">-&gt;h</span><span class="syntax18">(</span><span class="syntax13">'</span><span class="syntax13">p</span><span class="syntax13">'</span> <span class="syntax18">,</span><span class="syntax13">'</span><span class="syntax13">The</span><span class="syntax13"> </span><span class="syntax13">server</span><span class="syntax13"> </span><span class="syntax13">time</span><span class="syntax13"> </span><span class="syntax13">is:</span><span class="syntax13">'</span><span class="syntax18">)</span><span class="syntax18">;</span>
        
        <span class="syntax4">#</span><span class="syntax4"> </span><span class="syntax4">Give</span><span class="syntax4"> </span><span class="syntax4">this</span><span class="syntax4"> </span><span class="syntax4">element</span><span class="syntax4"> </span><span class="syntax4">an</span><span class="syntax4"> </span><span class="syntax4">ID,</span><span class="syntax4"> </span><span class="syntax4">so</span><span class="syntax4"> </span><span class="syntax4">it</span><span class="syntax4"> </span><span class="syntax4">can</span><span class="syntax4"> </span><span class="syntax4">be</span>
        <span class="syntax4">#</span><span class="syntax4"> </span><span class="syntax4">refreshed.</span>
        <span class="syntax10">$p</span> <span class="syntax18">=</span> <span class="syntax11">$top</span><span class="syntax6">-&gt;h</span><span class="syntax18">(</span><span class="syntax13">'</span><span class="syntax13">p</span><span class="syntax13">'</span> <span class="syntax18">,</span><span class="syntax9">date</span><span class="syntax18">(</span><span class="syntax13">'</span><span class="syntax13">r</span><span class="syntax13">'</span><span class="syntax18">,</span><span class="syntax9">time</span><span class="syntax18">(</span><span class="syntax18">)</span><span class="syntax18">)</span><span class="syntax18">)</span><span class="syntax18">;</span>
        <span class="syntax11">$p</span><span class="syntax11">-&gt;hp</span><span class="syntax18">[</span><span class="syntax13">'</span><span class="syntax13">id</span><span class="syntax13">'</span><span class="syntax18">]</span> <span class="syntax18">=</span> <span class="syntax13">'</span><span class="syntax13">the_time_paragraph</span><span class="syntax13">'</span><span class="syntax18">;</span>
        
        <span class="syntax10">$input</span> <span class="syntax18">=</span> <span class="syntax11">$top</span><span class="syntax6">-&gt;h</span><span class="syntax18">(</span><span class="syntax13">'</span><span class="syntax13">input</span><span class="syntax13">'</span><span class="syntax18">,</span><span class="syntax13">'</span><span class="syntax13">Refresh</span><span class="syntax13"> </span><span class="syntax13">Time</span><span class="syntax13">'</span><span class="syntax18">)</span><span class="syntax18">;</span>
        <span class="syntax11">$input</span><span class="syntax11">-&gt;hp</span><span class="syntax18">[</span><span class="syntax13">'</span><span class="syntax13">type</span><span class="syntax13">'</span><span class="syntax18">]</span> <span class="syntax18">=</span> <span class="syntax13">'</span><span class="syntax13">button</span><span class="syntax13">'</span><span class="syntax18">;</span>
        <span class="syntax11">$input</span><span class="syntax11">-&gt;code</span><span class="syntax18">[</span><span class="syntax13">'</span><span class="syntax13">click</span><span class="syntax13">'</span><span class="syntax18">]</span> <span class="syntax18">=</span> <span class="syntax17">&lt;&lt;&lt;JS</span>
<span class="syntax17"> </span><span class="syntax17"> </span><span class="syntax17"> </span><span class="syntax17"> </span><span class="syntax17"> </span><span class="syntax17"> </span><span class="syntax17"> </span><span class="syntax17"> </span><span class="syntax8">function</span><span class="syntax18">(</span><span class="syntax17">e</span><span class="syntax18">)</span><span class="syntax17"> </span><span class="syntax18">{</span>
<span class="syntax17"> </span><span class="syntax17"> </span><span class="syntax17"> </span><span class="syntax17"> </span><span class="syntax17"> </span><span class="syntax17"> </span><span class="syntax17"> </span><span class="syntax17"> </span><span class="syntax17"> </span><span class="syntax17"> </span><span class="syntax17"> </span><span class="syntax17"> </span><span class="syntax17">ua</span><span class="syntax18">.</span><span class="syntax17">json</span><span class="syntax18">.</span><span class="syntax6">init</span><span class="syntax18">(</span><span class="syntax13">'</span><span class="syntax13">x6page</span><span class="syntax13">'</span><span class="syntax18">,</span><span class="syntax13">'</span><span class="syntax13">jsonexample</span><span class="syntax13">'</span><span class="syntax18">)</span><span class="syntax18">;</span>
<span class="syntax17"> </span><span class="syntax17"> </span><span class="syntax17"> </span><span class="syntax17"> </span><span class="syntax17"> </span><span class="syntax17"> </span><span class="syntax17"> </span><span class="syntax17"> </span><span class="syntax17"> </span><span class="syntax17"> </span><span class="syntax17"> </span><span class="syntax17"> </span><span class="syntax17">ua</span><span class="syntax18">.</span><span class="syntax17">json</span><span class="syntax18">.</span><span class="syntax6">addParm</span><span class="syntax18">(</span><span class="syntax13">'</span><span class="syntax13">x6action</span><span class="syntax13">'</span><span class="syntax18">,</span><span class="syntax13">'</span><span class="syntax13">refreshtime</span><span class="syntax13">'</span><span class="syntax18">)</span><span class="syntax18">;</span>
<span class="syntax17"> </span><span class="syntax17"> </span><span class="syntax17"> </span><span class="syntax17"> </span><span class="syntax17"> </span><span class="syntax17"> </span><span class="syntax17"> </span><span class="syntax17"> </span><span class="syntax17"> </span><span class="syntax17"> </span><span class="syntax17"> </span><span class="syntax17"> </span><span class="syntax8">if</span><span class="syntax18">(</span><span class="syntax17">ua</span><span class="syntax18">.</span><span class="syntax17">json</span><span class="syntax18">.</span><span class="syntax6">execute</span><span class="syntax18">(</span><span class="syntax18">)</span><span class="syntax18">)</span><span class="syntax17"> </span><span class="syntax18">{</span>
<span class="syntax17"> </span><span class="syntax17"> </span><span class="syntax17"> </span><span class="syntax17"> </span><span class="syntax17"> </span><span class="syntax17"> </span><span class="syntax17"> </span><span class="syntax17"> </span><span class="syntax17"> </span><span class="syntax17"> </span><span class="syntax17"> </span><span class="syntax17"> </span><span class="syntax17"> </span><span class="syntax17"> </span><span class="syntax17"> </span><span class="syntax17"> </span><span class="syntax17">ua</span><span class="syntax18">.</span><span class="syntax17">json</span><span class="syntax18">.</span><span class="syntax6">process</span><span class="syntax18">(</span><span class="syntax18">)</span><span class="syntax18">;</span>
<span class="syntax17"> </span><span class="syntax17"> </span><span class="syntax17"> </span><span class="syntax17"> </span><span class="syntax17"> </span><span class="syntax17"> </span><span class="syntax17"> </span><span class="syntax17"> </span><span class="syntax17"> </span><span class="syntax17"> </span><span class="syntax17"> </span><span class="syntax17"> </span><span class="syntax18">}</span>
<span class="syntax17"> </span><span class="syntax17"> </span><span class="syntax17"> </span><span class="syntax17"> </span><span class="syntax17"> </span><span class="syntax17"> </span><span class="syntax17"> </span><span class="syntax17"> </span><span class="syntax18">}</span>
<span class="syntax17">JS</span><span class="syntax18">;</span>
        <span class="syntax11">$top</span><span class="syntax6">-&gt;render</span><span class="syntax18">(</span><span class="syntax18">)</span><span class="syntax18">;</span>
    <span class="syntax18">}</span>
    
    <span class="syntax4">#</span><span class="syntax4"> </span><span class="syntax4">This</span><span class="syntax4"> </span><span class="syntax4">routine</span><span class="syntax4"> </span><span class="syntax4">handles</span><span class="syntax4"> </span><span class="syntax4">the</span><span class="syntax4"> </span><span class="syntax4">call</span>
    <span class="syntax8">function</span> <span class="syntax6">refreshtime</span><span class="syntax18">(</span><span class="syntax18">)</span> <span class="syntax18">{</span>
        <span class="syntax6">x6html</span><span class="syntax18">(</span><span class="syntax13">'</span><span class="syntax13">the_time_paragraph</span><span class="syntax13">'</span><span class="syntax18">,</span><span class="syntax9">date</span><span class="syntax18">(</span><span class="syntax13">'</span><span class="syntax13">r</span><span class="syntax13">'</span><span class="syntax18">,</span><span class="syntax9">time</span><span class="syntax18">(</span><span class="syntax18">)</span><span class="syntax18">)</span><span class="syntax18">)</span><span class="syntax18">;</span>
        <span class="syntax6">x6script</span><span class="syntax18">(</span><span class="syntax14">&quot;</span><span class="syntax14">alert</span><span class="syntax14">(</span><span class="syntax14">'</span><span class="syntax14">Now</span><span class="syntax14"> </span><span class="syntax14">you</span><span class="syntax14"> </span><span class="syntax14">know</span><span class="syntax14"> </span><span class="syntax14">what</span><span class="syntax14"> </span><span class="syntax14">time</span><span class="syntax14"> </span><span class="syntax14">I</span><span class="syntax14"> </span><span class="syntax14">think</span><span class="syntax14"> </span><span class="syntax14">it</span><span class="syntax14"> </span><span class="syntax14">is</span><span class="syntax14">'</span><span class="syntax14">)</span><span class="syntax14">&quot;</span><span class="syntax18">)</span><span class="syntax18">;</span>
    <span class="syntax18">}</span>
<span class="syntax18">}</span>
<span class="syntax17">?&gt;</span>
</span></pre>

<p>You can have any amount of script returned with the x6script,
   the only practical limit is bandwidth and the browser's 
   processing power.
</p>

<p>It is safe to put SCRIPT tags around the script, the x6script()
   routine strips them out, so the following is perfectly safe:
</p>

<pre><span class="syntax0"><span class="syntax17">&lt;?php</span>
<span class="syntax8">class</span><span class="syntax8"> </span><span class="syntax11">x6jsonexample</span><span class="syntax11"> </span><span class="syntax8">extends</span><span class="syntax11"> </span><span class="syntax11">androX6</span><span class="syntax11"> </span><span class="syntax18">{</span>
    <span class="syntax8">function</span> <span class="syntax6">x6main</span><span class="syntax18">(</span><span class="syntax18">)</span> <span class="syntax18">{</span>
        <span class="syntax4">#</span><span class="syntax4"> </span><span class="syntax4">....</span><span class="syntax4"> </span>
    <span class="syntax18">}</span>
    
    <span class="syntax8">function</span> <span class="syntax6">refreshtime</span><span class="syntax18">(</span><span class="syntax18">)</span> <span class="syntax18">{</span>
        <span class="syntax9">ob_start</span><span class="syntax18">(</span><span class="syntax18">)</span><span class="syntax18">;</span>
        <span class="syntax17">?&gt;</span>
        <span class="syntax17">&lt;script</span><span class="syntax17">&gt;</span>
<span class="syntax17"> </span><span class="syntax17"> </span><span class="syntax17"> </span><span class="syntax17"> </span><span class="syntax17"> </span><span class="syntax17"> </span><span class="syntax17"> </span><span class="syntax17"> </span><span class="syntax17">window</span><span class="syntax18">.</span><span class="syntax17">newFunction</span><span class="syntax17"> </span><span class="syntax18">=</span><span class="syntax17"> </span><span class="syntax8">function</span><span class="syntax18">(</span><span class="syntax18">)</span><span class="syntax17"> </span><span class="syntax18">{</span>
<span class="syntax17"> </span><span class="syntax17"> </span><span class="syntax17"> </span><span class="syntax17"> </span><span class="syntax17"> </span><span class="syntax17"> </span><span class="syntax17"> </span><span class="syntax17"> </span><span class="syntax17"> </span><span class="syntax17"> </span><span class="syntax17"> </span><span class="syntax17"> </span><span class="syntax8">var</span><span class="syntax17"> </span><span class="syntax17">x</span><span class="syntax17"> </span><span class="syntax18">=</span><span class="syntax17"> </span><span class="syntax18">{</span><span class="syntax17"> </span><span class="syntax17">parm</span><span class="syntax18">:</span><span class="syntax17"> </span><span class="syntax13">'</span><span class="syntax13">value</span><span class="syntax13">'</span><span class="syntax18">,</span><span class="syntax17"> </span><span class="syntax17">parm2</span><span class="syntax18">:</span><span class="syntax17"> </span><span class="syntax13">'</span><span class="syntax13">value</span><span class="syntax13">'</span><span class="syntax17"> </span><span class="syntax18">}</span><span class="syntax18">;</span>
<span class="syntax17"> </span><span class="syntax17"> </span><span class="syntax17"> </span><span class="syntax17"> </span><span class="syntax17"> </span><span class="syntax17"> </span><span class="syntax17"> </span><span class="syntax17"> </span><span class="syntax17"> </span><span class="syntax17"> </span><span class="syntax17"> </span><span class="syntax17"> </span><span class="syntax8">for</span><span class="syntax18">(</span><span class="syntax8">var</span><span class="syntax17"> </span><span class="syntax17">idx</span><span class="syntax17"> </span><span class="syntax8">in</span><span class="syntax17"> </span><span class="syntax17">x</span><span class="syntax18">)</span><span class="syntax17"> </span><span class="syntax18">{</span>
<span class="syntax17"> </span><span class="syntax17"> </span><span class="syntax17"> </span><span class="syntax17"> </span><span class="syntax17"> </span><span class="syntax17"> </span><span class="syntax17"> </span><span class="syntax17"> </span><span class="syntax17"> </span><span class="syntax17"> </span><span class="syntax17"> </span><span class="syntax17"> </span><span class="syntax17"> </span><span class="syntax17"> </span><span class="syntax17"> </span><span class="syntax17"> </span><span class="syntax17">console</span><span class="syntax18">.</span><span class="syntax6">log</span><span class="syntax18">(</span><span class="syntax17">idx</span><span class="syntax18">,</span><span class="syntax17">idx</span><span class="syntax18">[</span><span class="syntax17">x</span><span class="syntax18">]</span><span class="syntax18">)</span><span class="syntax18">;</span>
<span class="syntax17"> </span><span class="syntax17"> </span><span class="syntax17"> </span><span class="syntax17"> </span><span class="syntax17"> </span><span class="syntax17"> </span><span class="syntax17"> </span><span class="syntax17"> </span><span class="syntax17"> </span><span class="syntax17"> </span><span class="syntax17"> </span><span class="syntax17"> </span><span class="syntax18">}</span>
<span class="syntax17"> </span><span class="syntax17"> </span><span class="syntax17"> </span><span class="syntax17"> </span><span class="syntax17"> </span><span class="syntax17"> </span><span class="syntax17"> </span><span class="syntax17"> </span><span class="syntax18">}</span>
<span class="syntax17"> </span><span class="syntax17"> </span><span class="syntax17"> </span><span class="syntax17"> </span><span class="syntax17"> </span><span class="syntax17"> </span><span class="syntax17"> </span><span class="syntax17"> </span><span class="syntax6">newFunction</span><span class="syntax18">(</span><span class="syntax18">)</span><span class="syntax18">;</span>
<span class="syntax17"> </span><span class="syntax17"> </span><span class="syntax17"> </span><span class="syntax17"> </span><span class="syntax17"> </span><span class="syntax17"> </span><span class="syntax17"> </span><span class="syntax17"> </span><span class="syntax17">&lt;/script&gt;</span>
        <span class="syntax17">&lt;?php</span>
        <span class="syntax6">x4Script</span><span class="syntax18">(</span><span class="syntax9">ob_get_clean</span><span class="syntax18">(</span><span class="syntax18">)</span><span class="syntax18">)</span><span class="syntax18">;</span>
    <span class="syntax18">}</span>
<span class="syntax18">}</span>
<span class="syntax17">?&gt;</span>
</span></pre>
